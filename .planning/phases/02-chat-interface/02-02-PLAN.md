---
phase: 02-chat-interface
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/chat/MessageInput.tsx
  - src/components/chat/MessageList.tsx
  - src/components/chat/MessageBubble.tsx
  - src/components/chat/StreamingIndicator.tsx
  - src/components/chat/ChatToolbar.tsx
  - src/components/chat/WelcomeScreen.tsx
autonomous: true
requirements:
  - CHAT-01
  - CHAT-02
  - CHAT-03
  - CHAT-06
  - CHAT-07
  - CHAT-08
must_haves:
  truths:
    - User can type in auto-resizing input field
    - User can send with Enter or Send button
    - Messages display in a scrollable list
    - User can copy any message to clipboard
    - User can regenerate the last AI response
    - User can clear the current conversation
    - Streaming indicator shows while AI is generating
  artifacts:
    - path: src/components/chat/MessageInput.tsx
      provides: Auto-resizing textarea with send button
      exports: ["MessageInput"]
    - path: src/components/chat/MessageList.tsx
      provides: Scrollable message list container
      exports: ["MessageList"]
    - path: src/components/chat/MessageBubble.tsx
      provides: Individual message with copy/regenerate actions
      exports: ["MessageBubble"]
    - path: src/components/chat/StreamingIndicator.tsx
      provides: Visual indicator during AI generation
      exports: ["StreamingIndicator"]
    - path: src/components/chat/ChatToolbar.tsx
      provides: Toolbar with regenerate and clear buttons
      exports: ["ChatToolbar"]
    - path: src/components/chat/WelcomeScreen.tsx
      provides: Empty state with welcome message and suggestions
      exports: ["WelcomeScreen"]
  key_links:
    - from: MessageInput.tsx
      to: useChat hook
      via: sendMessage callback
      pattern: "const { sendMessage } = useChat()"
    - from: MessageList.tsx
      to: MessageBubble.tsx
      via: Component composition
      pattern: "<MessageBubble key={message.id} />"
    - from: MessageBubble.tsx
      to: navigator.clipboard API
      via: Copy button click handler
      pattern: "navigator.clipboard.writeText()"
---

<objective>
Create the core chat UI components for message input, display, and actions.

Purpose: Provide the visual interface for users to interact with the AI chat, including input, message display, and message actions.
Output: Complete set of chat components following the design decisions from CONTEXT.md.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-chat-interface/02-CONTEXT.md
@.planning/phases/02-chat-interface/02-RESEARCH.md
@src/hooks/useChat.ts
@src/components/ui/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MessageInput component with auto-resize</name>
  <files>src/components/chat/MessageInput.tsx</files>
  <action>
    Create src/components/chat/MessageInput.tsx:

    1. Import React, useRef, useCallback, useState from 'react'
    2. Import { Send, Loader2 } from 'lucide-react'
    3. Import { Button } from '@/components/ui/Button'
    4. Import { cn } from '@/lib/utils'

    5. Define MessageInputProps interface:
       - onSend: (content: string) => void
       - isDisabled?: boolean
       - placeholder?: string

    6. Create MessageInput component:
       - Use useRef for textarea element
       - Use useState for input value
       - Implement adjustHeight function:
         * Set height to 'auto'
         * Set height to scrollHeight (capped at 200px)
       - Use useEffect to adjust height when value changes

    7. Implement handleKeyDown:
       - If Enter without Shift: prevent default, call handleSend
       - If Enter with Shift: allow newline

    8. Implement handleSend:
       - Trim content
       - If not empty and not disabled: call onSend, clear input, reset height

    9. Render:
       - Container div with border, rounded-xl, bg-white
       - Textarea with:
         * ref, value, onChange, onKeyDown
         * placeholder
         * disabled={isDisabled}
         * className for styling (resize-none, transparent bg)
         * rows={1}
       - Send button (absolute positioned right side):
         * Show Loader2 spinner if isDisabled
         * Show Send icon otherwise
         * onClick={handleSend}
         * disabled={isDisabled || !value.trim()}

    10. Follow CLAUDE.md component structure and styling guidelines
        - Use Tailwind for styling
        - Max 200 lines
        - Export as named export
  </action>
  <verify>
    npm run type-check passes
    grep -E "(MessageInput|auto-resiz|textarea)" src/components/chat/MessageInput.tsx
  </verify>
  <done>
    MessageInput component exists with auto-resizing textarea, Enter-to-send, and disabled state support
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MessageBubble component with copy/regenerate</name>
  <files>src/components/chat/MessageBubble.tsx</files>
  <action>
    Create src/components/chat/MessageBubble.tsx:

    1. Import React, useState, useCallback from 'react'
    2. Import { User, Bot, Copy, Check, RotateCcw } from 'lucide-react'
    3. Import { cn } from '@/lib/utils'
    4. Import type { Message } from '@/types/index'

    5. Define MessageBubbleProps interface:
       - message: Message
       - isStreaming?: boolean
       - onRegenerate?: () => void
       - isLast?: boolean

    6. Create MessageBubble component:
       - Determine isUser = message.role === 'user'
       - Use useState for copied state (to show checkmark briefly)

    7. Implement handleCopy:
       - Use navigator.clipboard.writeText(message.content)
       - Set copied state to true
       - Reset after 2 seconds
       - Wrap in try-catch for error handling

    8. Render structure:
       - Outer div with flex, gap-4, py-6
       - Conditional flex-row-reverse for user messages
       - Avatar div (circular, 32px):
         * User: bg-[#FF6B35] (orange per design language)
         * AI: bg-gray-200
         * Icon: User or Bot from lucide-react
       - Message content container:
         * max-w-[80%] for readability
         * Rounded-2xl per design language
         * User: bg-[#FF6B35] text-white (primary orange)
         * AI: bg-white border border-gray-200 text-gray-900
         * Shadow-sm

    9. Message content:
       - User: <p className="whitespace-pre-wrap">{message.content}</p>
       - AI: Render content with whitespace-pre-wrap for now (markdown in next plan)

    10. Actions row (below message, visible on hover for older messages, always for last):
        - Container with opacity-0 group-hover:opacity-100 transition
        - Always visible if isLast
        - Copy button with Copy/Check icon
        - Regenerate button (only for AI messages with onRegenerate)
        - Timestamp on hover (format: relative time or HH:MM)

    11. Streaming indicator:
        - If isStreaming: show animated cursor (blinking vertical bar)

    12. Add group class to outer div for hover effects
  </action>
  <verify>
    npm run type-check passes
    grep -E "(MessageBubble|handleCopy|isUser)" src/components/chat/MessageBubble.tsx
  </verify>
  <done>
    MessageBubble component exists with proper styling, copy functionality, and regenerate action
  </done>
</task>

<task type="auto">
  <name>Task 3: Create MessageList, StreamingIndicator, ChatToolbar, and WelcomeScreen</name>
  <files>src/components/chat/MessageList.tsx, src/components/chat/StreamingIndicator.tsx, src/components/chat/ChatToolbar.tsx, src/components/chat/WelcomeScreen.tsx</files>
  <action>
    Create four components in src/components/chat/:

    **StreamingIndicator.tsx:**
    1. Simple component showing AI is thinking/generating
    2. Use prompt-kit style or custom implementation:
       - Animated dots or pulsing effect
       - "Thinking..." or "Generating..." text
       - Stop button (red X or square icon)
    3. Props: onStop: () => void
    4. Style with orange accent color

    **ChatToolbar.tsx:**
    1. Props:
       - onRegenerate?: () => void
       - onClear: () => void
       - canRegenerate: boolean
       - isStreaming: boolean
    2. Render horizontal toolbar above input:
       - Regenerate button (RotateCcw icon) - disabled if !canRegenerate or isStreaming
       - Clear chat button (Trash2 icon) - disabled if isStreaming
       - Small text buttons with icons
    3. Style: subtle, border-t, py-2

    **WelcomeScreen.tsx:**
    1. Props:
       - onSuggestionClick: (suggestion: string) => void
    2. Render centered welcome content:
       - Lokul logo or icon (large)
       - "How can I help you today?" heading
       - Grid of suggestion cards (3-4 suggestions):
         * "Explain quantum computing in simple terms"
         * "Write a Python function to sort a list"
         * "Help me brainstorm ideas for a blog post"
         * "What's the difference between React and Vue?"
       - Each card: clickable, hover effect, rounded-xl, border
    3. Style: Centered, generous spacing, warm cream background compatible

    **MessageList.tsx:**
    1. Import MessageBubble, StreamingIndicator
    2. Import useChat hook for messages, isStreaming, streamingContent
    3. Import useRef, useEffect for auto-scroll
    4. Props: none (uses hook)
    5. Render:
       - Scrollable container (flex-1, overflow-y-auto)
       - Map through messages, render MessageBubble for each
       - Pass isLast={index === messages.length - 1}
       - If isStreaming and streamingContent: render MessageBubble for streaming message
       - If isStreaming: render StreamingIndicator
    6. Auto-scroll to bottom:
       - useRef for scroll container
       - useEffect to scroll when messages change or streamingContent updates
       - scrollIntoView({ behavior: 'smooth' }) on dummy element at bottom
    7. Empty state: Show placeholder or nothing (WelcomeScreen handles empty state at parent level)

    Follow CLAUDE.md component guidelines throughout.
  </action>
  <verify>
    npm run type-check passes
    ls src/components/chat/*.tsx | wc -l (should be 6+ files)
  </verify>
  <done>
    All four components exist with proper functionality and styling
  </done>
</task>

</tasks>

<verification>
- All components compile without TypeScript errors
- MessageInput has auto-resize and Enter-to-send
- MessageBubble has proper alignment (user right, AI left) and colors
- Copy functionality works via navigator.clipboard
- WelcomeScreen shows suggestions grid
- ChatToolbar has regenerate and clear buttons
</verification>

<success_criteria>
- User can type in auto-resizing input
- User can send messages with Enter or button
- Messages display with proper alignment and colors
- Copy button copies message content to clipboard
- Regenerate button triggers message regeneration
- Clear chat button clears current conversation
- Welcome screen shows when no messages
</success_criteria>

<output>
After completion, create `.planning/phases/02-chat-interface/02-02-SUMMARY.md`
</output>
