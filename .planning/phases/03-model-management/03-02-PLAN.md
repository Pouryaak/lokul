---
phase: 03-model-management
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/chat-layout/AppSidebar.tsx
  - src/components/chat-layout/app-sidebar-parts.tsx
  - src/components/chat-layout/ChatLayout.tsx
  - src/components/Chat/ai-chat-parts.tsx
  - src/components/Chat/AIChatInterface.tsx
  - src/components/model/DownloadManager.tsx
  - src/components/model/InputModelSelector.tsx
autonomous: true
requirements:
  - MODEL-02
  - MODEL-05
  - MODEL-06
must_haves:
  truths:
    - "Users can control model selection from input actions on desktop and mobile."
    - "Users can inspect model download lifecycle from a header-right Download Manager."
    - "Users can cancel a model download only after explicit confirmation."
  artifacts:
    - path: "src/components/model/InputModelSelector.tsx"
      provides: "Input-anchored model selector with active-request visual state"
    - path: "src/components/model/DownloadManager.tsx"
      provides: "Header-right panel with per-model status, progress, failure, and retry UI"
    - path: "src/components/chat-layout/ChatLayout.tsx"
      provides: "Layout slot for Download Manager trigger/panel without header model badge"
    - path: "src/components/chat-layout/AppSidebar.tsx"
      provides: "Sidebar without model selector surface"
  key_links:
    - from: "src/components/Chat/ai-chat-parts.tsx"
      to: "src/components/model/InputModelSelector.tsx"
      via: "input action composition"
      pattern: "InputModelSelector"
    - from: "src/components/chat-layout/ChatLayout.tsx"
      to: "src/components/model/DownloadManager.tsx"
      via: "header-right trigger and panel render"
      pattern: "DownloadManager"
    - from: "src/components/model/DownloadManager.tsx"
      to: "src/components/ui/ConfirmDialog.tsx"
      via: "cancel confirmation modal"
      pattern: "ConfirmDialog"
---

<objective>
Restructure chat UI so model controls live near the input and download lifecycle visibility is centralized in a dedicated header-right Download Manager.

Purpose: Honor locked UX decisions and remove outdated sidebar/global model interaction patterns.
Output: Presentational selector and manager surfaces ready for orchestration wiring, with cancel confirmation and retry affordances.
</objective>

<execution_context>
@/Users/poak/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/poak/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-model-management/03-CONTEXT.md
@.planning/phases/03-model-management/03-RESEARCH.md
@.planning/phases/02.1-ai-sdk-ui-migration-with-routing/02.1-07-SUMMARY.md
@src/components/chat-layout/AppSidebar.tsx
@src/components/chat-layout/app-sidebar-parts.tsx
@src/components/chat-layout/ChatLayout.tsx
@src/components/Chat/ai-chat-parts.tsx
@src/components/ui/ConfirmDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move model selector from sidebar to input action area</name>
  <files>src/components/chat-layout/AppSidebar.tsx, src/components/chat-layout/app-sidebar-parts.tsx, src/components/Chat/ai-chat-parts.tsx, src/components/model/InputModelSelector.tsx</files>
  <action>Remove sidebar model selector usage entirely and add a new input-adjacent model selector component integrated into `InputSection` composition. Keep desktop and mobile placement identical (near input actions), and do not add a header model label/badge. Include visual states for active/requested/ready to satisfy MODEL-02 visibility intent via selector + manager, not header badge (locked decision overrides older roadmap wording).</action>
  <verify>npm run type-check</verify>
  <done>There is no sidebar selector, and users can initiate model choice from input actions on both desktop and mobile layouts.</done>
</task>

<task type="auto">
  <name>Task 2: Add dedicated Download Manager shell in header-right</name>
  <files>src/components/chat-layout/ChatLayout.tsx, src/components/model/DownloadManager.tsx, src/components/Chat/AIChatInterface.tsx</files>
  <action>Create a `DownloadManager` component rendered from the top-right header area with per-model cards/rows and status badges for Queued, Downloading, Compiling, Ready, Failed, Canceled. Include progress percentage and ETA fields, inline Retry affordance for failed rows, and an explicit cancel action guarded by `ConfirmDialog`. Keep panel non-blocking and compatible with existing PerformancePanel trigger region (co-located controls, no overlap regressions).</action>
  <verify>npm run type-check && npm run lint</verify>
  <done>Header-right area exposes Download Manager trigger/panel with detailed lifecycle UI, retry controls, and cancel-confirm interaction paths.</done>
</task>

</tasks>

<verification>
1. Confirm sidebar no longer renders any model selector control.
2. Confirm model selector appears near message input actions on desktop and mobile breakpoints.
3. Confirm Download Manager can open from header-right and renders all lifecycle states with progress/ETA placeholders.
</verification>

<success_criteria>
- Model switching controls follow the locked Claude-style placement near input.
- Download lifecycle visibility is explicit and centralized in the header-right manager.
- Cancel actions are protected by confirmation and failure rows expose inline retry affordance.
</success_criteria>

<output>
After completion, create `.planning/phases/03-model-management/03-model-management-02-SUMMARY.md`
</output>
