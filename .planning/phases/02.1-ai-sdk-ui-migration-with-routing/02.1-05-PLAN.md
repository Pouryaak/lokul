---
phase: 02.1-ai-sdk-ui-migration-with-routing
plan: 05
type: execute
wave: 3
depends_on: ["02.1-04"]
files_modified:
  - src/components/ai-elements/message.tsx
  - src/components/chat/AIChatInterface.tsx
  - src/components/chat/WelcomeScreen.tsx
autonomous: true
requirements:
  - CHAT-06
  - CHAT-07
  - CHAT-08
must_haves:
  truths:
    - "User can copy any message to clipboard with one click"
    - "User can regenerate the last AI response"
    - "User can clear the current conversation"
    - "Welcome screen shows suggested prompts for new chats"
    - "Message actions (copy, regenerate) are accessible"
  artifacts:
    - path: "src/components/ai-elements/message.tsx"
      provides: "Message component with actions"
      exports: ["Message", "MessageActions", "MessageAction"]
    - path: "src/components/chat/WelcomeScreen.tsx"
      provides: "Welcome screen with suggested prompts"
      exports: ["WelcomeScreen"]
    - path: "src/components/chat/AIChatInterface.tsx"
      provides: "Updated with message actions and toolbar"
      exports: ["AIChatInterface"]
  key_links:
    - from: "MessageAction"
      to: "navigator.clipboard"
      via: "copy handler"
      pattern: "navigator.clipboard.writeText(message.content)"
    - from: "AIChatInterface"
      to: "regenerate"
      via: "useAIChat hook"
      pattern: "const { regenerate } = useAIChat()"
---

<objective>
Add message actions (copy, regenerate), conversation clearing, and welcome screen with suggested prompts.

Purpose: These features complete the chat UX - users need to copy responses, retry failed generations, and get inspiration for new conversations.
Output: Fully functional chat interface with all interaction features.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.1-ai-sdk-ui-migration-with-routing/02.1-RESEARCH.md

@/Users/poak/Documents/personal-project/Lokul/src/components/Chat/ChatToolbar.tsx
@/Users/poak/Documents/personal-project/Lokul/src/components/Chat/WelcomeScreen.tsx
@/Users/poak/Documents/personal-project/Lokul/src/hooks/useAIChat.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add message actions (copy, regenerate)</name>
  <files>src/components/ai-elements/message.tsx, src/components/chat/AIChatInterface.tsx</files>
  <action>
    Add copy and regenerate actions to messages using ai-elements MessageActions.

    In AIChatInterface.tsx, update the Message rendering:
    ```tsx
    <Message key={message.id} from={message.role}>
      <MessageContent>
        {/* ... message content ... */}
      </MessageContent>
      <MessageActions>
        <MessageAction
          tooltip="Copy message"
          onClick={() => copyToClipboard(message.content)}
        >
          <CopyIcon className="h-4 w-4" />
        </MessageAction>
        {message.role === 'assistant' && isLastMessage && (
          <MessageAction
            tooltip="Regenerate response"
            onClick={() => regenerate()}
          >
            <RefreshCwIcon className="h-4 w-4" />
          </MessageAction>
        )}
      </MessageActions>
    </Message>
    ```

    Create copyToClipboard helper:
    ```typescript
    async function copyToClipboard(text: string) {
      try {
        await navigator.clipboard.writeText(text);
        toast.success('Copied to clipboard');
      } catch {
        toast.error('Failed to copy');
      }
    }
    ```

    For regenerate:
    1. Get regenerate function from useAIChat hook
    2. Only show regenerate on the last assistant message
    3. Disable during streaming

    Import icons from lucide-react:
    - CopyIcon for copy action
    - RefreshCwIcon for regenerate action
  </action>
  <verify>Copy and regenerate buttons appear on messages</verify>
  <done>Message actions implemented with copy and regenerate functionality</done>
</task>

<task type="auto">
  <name>Task 2: Add conversation clearing</name>
  <files>src/components/chat/AIChatInterface.tsx</files>
  <action>
    Add clear conversation functionality to AIChatInterface.

    Add a toolbar above the input (similar to existing ChatToolbar):
    ```tsx
    {messages.length > 0 && (
      <div className="flex justify-end gap-2 px-4 py-2">
        <Button
          variant="ghost"
          size="sm"
          onClick={handleClear}
          disabled={status === 'streaming'}
        >
          <TrashIcon className="mr-2 h-4 w-4" />
          Clear chat
        </Button>
      </div>
    )}
    ```

    Implement handleClear:
    ```typescript
    const handleClear = () => {
      // Option 1: Clear messages in current conversation
      setMessages([]);

      // Option 2: Navigate to /chat to create new conversation
      // navigate('/chat');
    };
    ```

    Per requirements (CHAT-08), "clear the current conversation" should empty the message list.
    Use setMessages from useAIChat hook to clear.

    Add confirmation dialog to prevent accidental clearing:
    ```typescript
    const handleClear = () => {
      if (confirm('Clear this conversation? This cannot be undone.')) {
        setMessages([]);
      }
    };
    ```

    Import TrashIcon from lucide-react.
  </action>
  <verify>Clear button appears when messages exist and clears on click</verify>
  <done>Clear conversation button with confirmation dialog</done>
</task>

<task type="auto">
  <name>Task 3: Create welcome screen with suggested prompts</name>
  <files>src/components/chat/WelcomeScreen.tsx</files>
  <action>
    Create or update WelcomeScreen component for the empty state.

    The welcome screen should:
    1. Show when messages.length === 0
    2. Display Lokul logo/branding
    3. Show suggested prompt buttons
    4. Allow clicking a suggestion to start chatting

    Suggested prompts (privacy-focused AI use cases):
    - "Help me brainstorm ideas for a project"
    - "Explain how WebGPU enables local AI"
    - "Write a TypeScript function to filter an array"
    - "What are the benefits of privacy-first apps?"

    Structure:
    ```tsx
    interface WelcomeScreenProps {
      onSuggestionClick: (suggestion: string) => void;
    }

    const SUGGESTIONS = [
      "Help me brainstorm ideas for a project",
      "Explain how WebGPU enables local AI",
      "Write a TypeScript function to filter an array",
      "What are the benefits of privacy-first apps?",
    ];

    export function WelcomeScreen({ onSuggestionClick }: WelcomeScreenProps) {
      return (
        <div className="flex h-full flex-col items-center justify-center px-4">
          <div className="mb-8 text-center">
            <h2 className="mb-2 text-2xl font-bold text-gray-900">
              Welcome to Lokul
            </h2>
            <p className="text-gray-600">
              Private AI that runs entirely on your device
            </p>
          </div>

          <div className="grid w-full max-w-2xl gap-3 sm:grid-cols-2">
            {SUGGESTIONS.map((suggestion) => (
              <button
                key={suggestion}
                onClick={() => onSuggestionClick(suggestion)}
                className="rounded-xl border border-gray-200 bg-white p-4 text-left transition-all hover:border-[#FF6B35] hover:shadow-md"
              >
                <p className="text-sm text-gray-700">{suggestion}</p>
              </button>
            ))}
          </div>
        </div>
      );
    }
    ```

    Integrate into AIChatInterface:
    - Replace ConversationEmptyState with WelcomeScreen
    - Pass sendMessage as onSuggestionClick

    Style with Lokul theme:
    - Suggestion cards: white background, orange border on hover
    - Typography: match existing styles
  </action>
  <verify>Welcome screen shows with 4 suggestion buttons</verify>
  <done>Welcome screen with suggested prompts integrated</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Copy button copies message text to clipboard
2. Regenerate button appears on last AI message and works
3. Clear button clears conversation with confirmation
4. Welcome screen shows when no messages
5. Suggestion buttons start conversation with that text
</verification>

<success_criteria>
- Copy message to clipboard works
- Regenerate last AI response works
- Clear conversation with confirmation works
- Welcome screen shows suggested prompts
- All actions have appropriate visual feedback
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-ai-sdk-ui-migration-with-routing/02.1-05-SUMMARY.md`
</output>
