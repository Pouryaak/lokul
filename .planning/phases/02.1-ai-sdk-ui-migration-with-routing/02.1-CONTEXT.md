# Phase 02.1: AI SDK UI Migration with Routing - Context

**Gathered:** 2026-02-18
**Status:** Ready for planning

<domain>
## Phase Boundary

Refactor chat architecture with proper URL routing (/chat, /chat/[id]), migrate to AI SDK UI for standardized chat patterns, integrate ai-elements components for better UX. This phase bridges the current custom implementation (Phase 2) and model management (Phase 3).

</domain>

<decisions>
## Implementation Decisions

### Routing structure
- Root URL (/) always shows the 11-section landing page (no redirect)
- /chat without ID creates a new empty conversation automatically
- Individual conversations at /chat/[id] pattern
- Non-existent conversation ID → redirect to /chat with warning toast
- Browser history pushes new entry when auto-creating at /chat (user can navigate back)

### AI SDK UI integration
- Use best industry approach (research ai-elements vs other options)
- Preference: clean, maintainable, industry best practice
- Do not reinvent the wheel if SDKs can handle it
- True streaming from WebLLM (not batch-then-stream)
- Error surfaced as object in conversation state (standard AI SDK pattern)

### Model switching behavior
- For v1: Changing model creates a new chat with the chosen model
- History doesn't transfer when switching models (clean slate)

### Component architecture
- Selective adoption strategy: Use components from different libraries as needed
- ai-elements components for core chat functionality where appropriate
- Message threading: Flat chronological (not grouped or thread-based)
- Sidebar: Use @blocks/sidebar-02 from blocks.so (collapsible)

### Design language
- Keep Lokul design language (orange/cream theme)
- Prioritize maintainability over strict design adherence
- Research ai-elements documentation for customization approach
- Apply Lokul colors/spacing to ai-elements components

### Chat UX behavior
- Auto-scroll: Use ai-elements Conversation component's built-in handling
- Loading state: Shimmering "Thinking..." text effect
- Input behavior: Allow typing during generation
- Send button becomes cancel/stop button during generation
- Input component: Use @blocks/ai-02 from blocks.so as reference
- Empty state: Welcome screen with suggested prompts

### Claude's Discretion
- Exact AI SDK UI provider implementation (research best approach)
- ai-elements customization specifics
- Specific shimmer animation implementation
- Welcome screen content and layout
- Error display formatting

</decisions>

<specifics>
## Specific Ideas

### Component References

**Sidebar:** @blocks/sidebar-02
```bash
npx shadcn@latest add @blocks/sidebar-02
```
Sample code provided for DashboardSidebar implementation pattern.

**Input:** @blocks/ai-02
```bash
npx shadcn@latest add @blocks/ai-02
```
Reference implementation shows:
- Auto-resizing textarea with model selector
- Prompt suggestion buttons
- Send/cancel button transformation
- Icon-based prompt suggestions

**Conversation:** ai-elements Conversation component
- URL: https://elements.ai-sdk.dev/components/conversation
- Handles scroll behavior automatically
- Manages message threading

### AI SDK Resources
- ai-elements documentation for customization patterns
- AI SDK UI provider patterns for WebLLM integration

</specifics>

<deferred>
## Deferred Ideas

### Model switching with context transfer
- For v1, changing models creates a fresh conversation
- Future version: Compact chat history and pass it to the new model so it can catch up
- This is NOT in scope for Phase 2.1 — consider for Phase 4 (Memory System)

</deferred>

---

*Phase: 02.1-ai-sdk-ui-migration-with-routing*
*Context gathered: 2026-02-18*
