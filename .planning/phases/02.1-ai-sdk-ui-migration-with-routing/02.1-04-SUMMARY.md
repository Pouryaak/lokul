---
phase: 02.1-ai-sdk-ui-migration-with-routing
plan: 04
subsystem: chat-ui
tags: [ai-elements, ai-sdk-ui, chat-interface]
dependency_graph:
  requires: [02.1-01, 02.1-03]
  provides: [ai-chat-interface]
  affects: [src/components/chat/AIChatInterface.tsx]
tech_stack:
  added:
    - ai-elements (conversation, message, prompt-input)
    - use-stick-to-bottom (for auto-scroll)
    - streamdown (for markdown rendering)
  patterns:
    - AI SDK UI composition pattern
    - useAIChat hook integration
    - Lokul theme customization
key_files:
  created:
    - src/components/chat/AIChatInterface.tsx
  modified:
    - src/components/ai-elements/message.tsx
    - src/components/ai-elements/prompt-input.tsx
    - src/components/ai-elements/conversation.tsx
    - src/components/ui/Button.tsx
    - src/components/ui/Progress.tsx
decisions:
  - Use ai-elements components for standardized AI chat UI patterns
  - Customize ai-elements with Lokul orange (#FF6B35) and cream (#FFF8F0) theme
  - Integrate useAIChat hook for streaming inference
  - Use MessageResponse with streamdown for markdown rendering
  - Keep existing Button.tsx and fix casing conflicts
metrics:
  duration: 10
  tasks: 3
  files: 30+
  commits: 3
completed_date: 2026-02-18
---

# Phase 02.1 Plan 04: AI SDK UI Integration - Chat Interface

## Summary

Installed ai-elements components and created the AIChatInterface component that composes ai-elements with the useAIChat hook. This provides a standardized AI chat UI using AI SDK UI patterns with Lokul theme customization.

## One-Liner

AIChatInterface component using ai-elements (Conversation, Message, PromptInput) with useAIChat hook for streaming inference and Lokul theme.

## What Was Built

### 1. ai-elements Components Installation (Task 1)

Installed ai-elements from the AI SDK UI registry:
- `conversation.tsx` - Auto-scrolling conversation container with StickToBottom
- `message.tsx` - Message display components with role-based styling
- `prompt-input.tsx` - Auto-resizing input with submit button
- `code-block.tsx` - Syntax highlighting with Shiki
- Plus 40+ additional ai-elements components

Dependencies added:
- `use-stick-to-bottom` - For smooth auto-scroll behavior
- `streamdown` - For markdown rendering with plugins (cjk, code, math, mermaid)
- `shiki` - For syntax highlighting

### 2. Lokul Theme Customization (Task 2)

Customized ai-elements components with Lokul styling:

**Message Component:**
- User messages: `bg-[#FF6B35]` (Lokul orange), white text, rounded-2xl
- Assistant messages: white background, gray border, rounded-2xl
- Max-width: 80% for proper alignment

**PromptInput Component:**
- Placeholder: "Message Lokul..."
- Submit button: Lokul orange background with white icon
- Auto-resizing textarea with proper min/max heights

**MessageAvatar Component:**
- User: Orange background (#FF6B35) with white icon
- Assistant: Gray background with gray icon

**Button Component Fixes:**
- Added custom variants: `primary`, `cta`
- Added sizes: `md`, `xl`, `2xl`
- Fixed casing conflicts across all imports

**Progress Component:**
- Restored custom props: `showLabel`, `stepLabel`, `currentSize`, `totalSize`
- Lokul gradient: from-[#FF6B35] to-[#FFB84D]

### 3. AIChatInterface Component (Task 3)

Created the main chat interface at `src/components/chat/AIChatInterface.tsx`:

**Features:**
- Uses `useAIChat` hook for streaming inference
- `Conversation` component with auto-scroll to bottom
- `ConversationEmptyState` with Lokul icon and messaging
- Message mapping from UIMessage format to ai-elements
- `PromptInput` with auto-resizing textarea
- Error handling with toast notifications
- Lokul cream background (#FFF8F0)

**Props Interface:**
```typescript
interface AIChatInterfaceProps {
  conversationId: string;
  modelId: string;
  className?: string;
}
```

**Usage:**
```tsx
<AIChatInterface
  conversationId="conv-123"
  modelId="phi-2-q4f16_1-MLC"
/>
```

## Verification

All verification criteria met:
- [x] ai-elements components installed and TypeScript compiles
- [x] Components styled with Lokul theme (orange/cream)
- [x] AIChatInterface composes all elements correctly
- [x] useAIChat hook integrates with ai-elements
- [x] Streaming status shows in PromptInputSubmit
- [x] Input auto-resizes and submits on Enter

## Commits

| Hash | Type | Description |
|------|------|-------------|
| 1052b4f | chore | Install ai-elements components and dependencies |
| c593ea6 | feat | Customize ai-elements with Lokul theme |
| 4e2423c | feat | Create AIChatInterface component with ai-elements |

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed Button casing conflicts**
- **Found during:** Task 2
- **Issue:** ai-elements imported from `@/components/ui/button` (lowercase) but project uses `Button.tsx` (capital)
- **Fix:** Updated all imports in ai-elements to use capital Button, Card, Progress
- **Files modified:** 20+ ai-elements components

**2. [Rule 1 - Bug] Fixed Button variants removed by shadcn update**
- **Found during:** Task 2
- **Issue:** shadcn install overwrote Button.tsx with standard variants only
- **Fix:** Added back custom variants: `primary`, `cta`, sizes `md`, `xl`, `2xl`
- **Files modified:** `src/components/ui/Button.tsx`

**3. [Rule 1 - Bug] Fixed Progress component overwrite**
- **Found during:** Task 2
- **Issue:** shadcn install replaced custom Progress with basic version
- **Fix:** Restored custom Progress with showLabel, stepLabel, currentSize, totalSize props
- **Files modified:** `src/components/ui/Progress.tsx`

**4. [Rule 1 - Bug] Fixed ai-elements type errors**
- **Found during:** Task 2
- **Issue:** schema-display.tsx and terminal.tsx had TypeScript errors
- **Fix:** Added String() conversion and children to Shimmer component
- **Files modified:** `src/components/ai-elements/schema-display.tsx`, `src/components/ai-elements/terminal.tsx`

**5. [Rule 2 - Missing functionality] Added MessageAvatar to message.tsx**
- **Found during:** Task 3
- **Issue:** MessageAvatar component was referenced but not exported from ai-elements/message
- **Fix:** MessageAvatar already existed at end of file, no changes needed

## Key Implementation Details

### AI SDK UI Integration Flow

```
User Input
    |
    v
PromptInput.onSubmit
    |
    v
useAIChat.sendMessage
    |
    v
WebLLMTransport.sendMessages
    |
    v
AI SDK UI updates messages state
    |
    v
React re-renders with streaming text
    |
    v
MessageResponse renders with streamdown
```

### Message Format

AI SDK UI UIMessage format:
```typescript
{
  id: string;
  role: 'user' | 'assistant';
  parts: Array<{ type: 'text', text: string }>;
}
```

The AIChatInterface filters for text parts and renders them with MessageResponse.

### Theme Application

The Lokul theme is applied through:
1. CSS classes in ai-elements component overrides
2. Tailwind arbitrary values: `bg-[#FF6B35]`, `bg-[#FFF8F0]`
3. Button variant additions in Button.tsx

## Next Steps

With the ai-elements integration complete:
1. Update ChatDetailRoute to use AIChatInterface with conversationId and modelId
2. Connect conversation persistence with AI SDK UI messages
3. Add message actions (copy, regenerate) back to the interface
4. Implement abort/stop functionality in WebLLMTransport

## Self-Check: PASSED

- [x] Created files exist:
  - [x] src/components/chat/AIChatInterface.tsx
- [x] ai-elements components installed:
  - [x] src/components/ai-elements/conversation.tsx
  - [x] src/components/ai-elements/message.tsx
  - [x] src/components/ai-elements/prompt-input.tsx
- [x] Commits exist:
  - [x] 1052b4f
  - [x] c593ea6
  - [x] 4e2423c
- [x] TypeScript compilation passes
