---
phase: 02.1-ai-sdk-ui-migration-with-routing
plan: 03
subsystem: routing
tags: [react-router, routing, navigation, toast]
dependency_graph:
  requires: [02.1-02]
  provides: [routing-infrastructure]
  affects: [02.1-04]
tech_stack:
  added:
    - react-router-dom@7.2.0
    - sonner@2.0.1
  patterns:
    - BrowserRouter with nested Routes
    - Route loaders with redirect pattern
    - Toast notifications for user feedback
key_files:
  created:
    - src/routes/RootLayout.tsx
    - src/routes/ChatRoute.tsx
    - src/routes/ChatDetailRoute.tsx
  modified:
    - src/App.tsx
    - package.json
    - package-lock.json
decisions:
  - Use BrowserRouter for client-side routing with history API
  - Auto-create conversation at /chat and redirect to /chat/:id
  - Use sonner for toast notifications (lightweight, modern)
  - Keep LandingPage as index route under RootLayout
  - ChatLayoutWrapper wraps chat routes with sidebar and performance panel
metrics:
  duration: 20
  tasks: 3
  files: 6
  commits: 2
completed_date: 2026-02-18
---

# Phase 2.1 Plan 03: React Router Configuration Summary

## Overview

Implemented React Router configuration with `/chat` and `/chat/[id]` routes. The routing enables URL-based navigation, deep linking to conversations, and browser history support. This transforms the app from state-based to URL-based navigation.

## What Was Built

### 1. Route Components (Task 1)

Created three route components in `src/routes/`:

**RootLayout.tsx**
- Simple layout wrapper for landing page routes
- Renders `<Outlet />` for nested routes
- Used for the root path (`/`) with landing page as index

**ChatRoute.tsx**
- Handles `/chat` (no ID)
- On mount, creates a new conversation using `createConversation()`
- Gets current model from modelStore (falls back to default)
- Navigates to `/chat/{newId}` with `replace: false` (adds to history)
- Shows loading state while creating

**ChatDetailRoute.tsx**
- Handles `/chat/:id`
- Gets conversation ID from `useParams()`
- Loads conversation using `getConversation(id)`
- If not found, shows toast warning and redirects to `/chat`
- If found, renders `ChatInterface` with conversation data

### 2. Router Configuration in App.tsx (Task 2)

Refactored App.tsx to use React Router:

```tsx
<BrowserRouter>
  <Routes>
    {/* Landing page routes */}
    <Route path="/" element={<RootLayout />}>
      <Route index element={<LandingPage />} />
      <Route path="loading" element={<LoadingPage />} />
    </Route>

    {/* Chat routes */}
    <Route path="chat" element={<ChatLayoutWrapper />}>
      <Route index element={<ChatRoute />} />
      <Route path=":id" element={<ChatDetailRoute />} />
    </Route>

    {/* Catch-all redirect to landing */}
    <Route path="*" element={<LandingPage />} />
  </Routes>
  <Toaster position="top-center" richColors />
</BrowserRouter>
```

**Key Components:**
- **LandingPage**: Extracted landing sections from old App.tsx, uses `navigate('/chat')`
- **LoadingPage**: Model download screen, navigates to `/chat` when ready
- **ChatLayoutWrapper**: Wraps chat routes with ChatLayout, performance panel, and status indicator

### 3. Toast Notifications (Task 3)

Integrated sonner for toast notifications:

- Installed `sonner` package
- Added `<Toaster position="top-center" richColors />` to App.tsx
- ChatDetailRoute uses `toast.warning()` for non-existent conversations
- ChatDetailRoute uses `toast.error()` for load failures

## Route Behavior

| Route | Behavior |
|-------|----------|
| `/` | Shows landing page |
| `/loading` | Shows model download screen |
| `/chat` | Creates new conversation, redirects to `/chat/{id}` |
| `/chat/:id` | Loads existing conversation or shows toast warning |
| `*` | Redirects to landing page |

## Browser History

The implementation correctly handles browser history:
- `/chat` uses `replace: false` so user can go back to landing
- `/chat/:id` routes add to history stack
- Back button navigates between conversations

## Dependencies Added

```json
{
  "react-router-dom": "^7.2.0",
  "sonner": "^2.0.1"
}
```

## Verification

- [x] TypeScript compilation passes (`npm run type-check`)
- [x] Routes are properly typed
- [x] `/` shows landing page
- [x] `/chat` creates new conversation
- [x] `/chat/:id` loads existing conversation
- [x] Invalid ID shows toast warning and redirects
- [x] Browser back button works between routes

## Commits

| Hash | Type | Description |
|------|------|-------------|
| e065755 | feat | Create route components for React Router |
| 69bead2 | feat | Configure React Router in App.tsx |

## Deviations from Plan

None - plan executed exactly as written.

## Key Implementation Details

### Model ID Handling

ChatRoute extracts the model ID correctly from the store:
```typescript
const currentModel = useModelStore((state) => state.currentModel);
const modelId = currentModel?.id || defaultModelId;
```

### Conversation Loading Pattern

ChatDetailRoute follows the load-then-render pattern:
1. Show loading spinner while fetching
2. If found, render ChatInterface
3. If not found, toast warning and redirect
4. Handle errors gracefully

### Navigation Flow

```
User clicks "Start Chatting"
    |
    v
LandingPage.handleStart()
    |
    v
loadModel() -> completeSetup()
    |
    v
navigate('/chat')
    |
    v
ChatRoute creates conversation
    |
    v
navigate('/chat/{id}')
    |
    v
ChatDetailRoute loads and renders
```

## Next Steps

With routing complete, the next plans in Phase 2.1 can:
1. Integrate AI SDK UI components into the routed chat interface
2. Connect conversation persistence with AI SDK UI
3. Add conversation list navigation in AppSidebar
4. Implement settings routing if needed

---

## Self-Check: PASSED

- [x] Created files exist:
  - [x] src/routes/RootLayout.tsx
  - [x] src/routes/ChatRoute.tsx
  - [x] src/routes/ChatDetailRoute.tsx
- [x] Modified files updated:
  - [x] src/App.tsx uses BrowserRouter
  - [x] package.json includes react-router-dom and sonner
- [x] Commits exist:
  - [x] e065755
  - [x] 69bead2
- [x] TypeScript compilation passes
